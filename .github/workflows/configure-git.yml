
name: configure-git

on:
  workflow_call:

jobs:
  configure:
    runs-on: ubuntu-latest
    steps:
      - env:
          SIGNING_KEY: ${{ secrets.SIGNING_KEY }}
          SIGNING_PUB: ${{ secrets.SIGNING_PUB }}
        run: |
          eval "$(ssh-agent -s)"
          install --directory ~/.ssh --mode 700
          base64 -d <<< '${{ secrets.SIGNING_KEY }}' > ~/.ssh/mex
          base64 -d <<< '${{ secrets.SIGNING_PUB }}' > ~/.ssh/mex.pub
          chmod 600 ~/.ssh/*
          ssh-add ~/.ssh/mex
          git config --local user.email ${{ vars.MEX_BOT_EMAIL }}
          git config --local user.name ${{ vars.MEX_BOT_USER }}
          git config --local gpg.format ssh
          git config --local user.signingkey ~/.ssh/mex.pub
          git config --local commit.gpgsign true
